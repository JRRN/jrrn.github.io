I"ï,<p>El patr√≥n Index Table se utiliza para crear √≠ndices secundarios sobre consultas, que la aplicaci√≥n necesita, en campos que no son una primary key y as√≠ tener un acceso a los datos con una aceptable optimizaci√≥n.</p>

<p>Situ√©monos, tenemos una tabla de productos, donde como es habitual, tenemos un id_producto como primary key, el campo nombre de producto, el tipo de producto y el precio.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) id_producto</th>
      <th style="text-align: center">producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Primary Key</li>
</ul>

<p>En nuestra aplicaci√≥n para buscar patatas ejecutar√≠amos la query:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * from TABLE Where id_producto = 1
</code></pre></div></div>

<p>Con lo que obtendr√≠amos con un buen rendimiento:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) id_producto</th>
      <th style="text-align: center">producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
  </tbody>
</table>

<p>Sin embargo, no siempre tenemos porque conocer el identificador de lo que estamos buscando en base de datos y esto nos penaliza si buscamos por ‚ÄúPatatas‚Äù.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * from TABLE Where producto = "Patatas"
</code></pre></div></div>

<p>A pesar de que lo encuentra, si tuvi√©ramos una base de datos con bastante peso, esta query podr√≠a penalizar al rendimiento de la aplicaci√≥n o incluso darnos un timeout en la query, cosa que no ser√≠a necesario si implement√°ramos Index Table.</p>

<p>Aunque existen motores de bases de datos, SQL Server lo permite, en los que puedes crear √≠ndices secundarios, puede ser una buena pr√°ctica no crear estos √≠ndices y usar este patr√≥n. Por otro lado, para aquellos motores NO-SQL en los que los √≠ndices ‚Äúno existen‚Äù (lo pongo entre comillas antes de que os tir√©is al cuello) este patr√≥n se ajusta bastante bien.</p>

<p>Al l√≠o.</p>

<p>Tenemos varias estrategias seg√∫n cuantos √≠ndices secundarios necesitamos:</p>

<p>La primera de ellas (romper la 1¬™ Forma Normal, 2¬™FN, 3¬™FN ‚Ä¶), recomendable cuando nuestros datos no se actualizan con frecuencia, duplicando la tabla pero cambiando la primary key:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) producto</th>
      <th style="text-align: center">id_producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">5</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<p>Si volvi√©ramos a ejecutar la consulta:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT * from TABLE_PRODUCT_NAME Where producto = "Patatas"
</code></pre></div></div>

<p>El rendimiento de nuestra query estar√≠a optimizado.</p>

<p>La segunda estrategia ser√≠a crear tablas con referencias a otras tablas formalizadas con los √≠ndices secundarios. M√°s vale un a imagen que mil palabras:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) id_producto</th>
      <th style="text-align: center">producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<p>relaci√≥n (*)id_producto = id_producto</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) producto</th>
      <th style="text-align: center">id_producto</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
    </tr>
    <tr>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">4</td>
    </tr>
    <tr>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">5</td>
    </tr>
  </tbody>
</table>

<p>De esta forma si quisi√©ramos obtener el precio de las patatas:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Id = SELECT id  from TABLE_PRODUCTS_NAME WHERE producto = "Patatas"
SELECT prices from TABLE_PRODUCTS WHERE id = "@Id"
</code></pre></div></div>

<p>Lo malo, s√≠, como vemos tenemos que tirar dos queries. ¬ø¬øY la JOIN?? Pensad en grandes bases de datos‚Ä¶</p>

<p>La tercera estrateg√≠a, es una mezcla entre la primera y la segunda, es decir, duplicar‚Ä¶ las tablas normalizadas pero con los √≠ndices que queramos y en funci√≥n de la SELECT hacer un switch a la tabla que contiene el √≠ndice por el WHERE que estamos buscando:</p>

<p>TABLE PRIMARY KEY PRODUCT_ID</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) id_producto</th>
      <th style="text-align: center">producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<p>TABLE PRIMARY KEY PRODUCT_NAME</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">(*) producto</th>
      <th style="text-align: center">id_producto</th>
      <th style="text-align: center">tipo_producto</th>
      <th style="text-align: center">precio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">Patatas</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">2</td>
    </tr>
    <tr>
      <td style="text-align: center">Zanahorias</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">1</td>
      <td style="text-align: center">3</td>
    </tr>
    <tr>
      <td style="text-align: center">Carne</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">2</td>
      <td style="text-align: center">6</td>
    </tr>
    <tr>
      <td style="text-align: center">Pescado</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
      <td style="text-align: center">5</td>
    </tr>
    <tr>
      <td style="text-align: center">Pl√°tanos</td>
      <td style="text-align: center">5</td>
      <td style="text-align: center">4</td>
      <td style="text-align: center">3</td>
    </tr>
  </tbody>
</table>

<p>Que buscamos ‚ÄúPatatas‚Äù pues atacamos a TABLE PRIMARY KEY PRODUCT_NAME, en cambio si buscamos por id atacaremos a TABLE PRIMARY KEY PRODUCT_ID.</p>

<blockquote>
  <p>Si busc√°ramos por nombre de producto y por tipo de producto una soluci√≥n es crear una tabla concatenado los estos par√°metros como clave primaria en la tabla resultante TABLE PRIMARY KEY PRODUCT_NAME+PRODUCT_TYPE.</p>
</blockquote>

<p>Un saludo.</p>
:ET